<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>JSDoc: Source: routes/api/users_manager.js</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css" />
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css" />
  </head>

  <body>
    <div id="main">
      <h1 class="page-title">Source: routes/api/users_manager.js</h1>

      <section>
        <article>
          <pre class="prettyprint source linenums"><code>/** Handles user entity
 * @module users_manager
 * @requires express
 * @requires database_api
 */
const express = require('express');
const database = require('../../database_api');
const router = express.Router();

/**
 * GET: User details
 * Sends user object if user exists
 * Sends null if user does not exist
 * @name /
 * @function
 * @inner
 * @param {string} req - Request
 * @param {string} res - Response
 */
router.get('/', async (req, res) => {
  const user_fav = database.connectCollection('user');
  console.log('Get user', req.query['id']);
  res.send(await user_fav.findOne({ id: req.query['id'] }));
});

/**
 * POST: Create new user entity
 * User entity: id, name, array of favorite carparks, array of search history results
 * @name /
 * @function
 * @inner
 * @param {string} req - Request
 * @param {string} res - Response
 */
router.post('/', async (req, res) => {
  const user_fav = database.connectCollection('user');
  console.log(req.body.id, req.body.name);
  await user_fav.insertOne({
    id: req.body.id,
    name: req.body.name,
    favorites: [],
    searchHistory: [],
  });
  res.status(201).send(); // to show successful
});

/**
 * POST: Update user entity
 * Update favorites, search history, or user name
 * @name /update
 * @function
 * @inner
 * @param {string} req - Request
 * @param {string} res - Response
 */
router.post('/update', async (req, res) => {
  const user_fav = database.connectCollection('user');
  switch (req.body.field) {
    case 'favorites':
      await user_fav.updateOne({ id: req.body.id }, { $set: { favorites: req.body.content } });
      break;
    case 'searchHistory':
      await user_fav.updateOne({ id: req.body.id }, { $set: { searchHistory: req.body.content } });
      break;
    case 'name':
      break;
    default:
      console.log('invalid field');
  }
  res.status(201).send(); // to show successful
});

module.exports = router;
</code></pre>
        </article>
      </section>
    </div>

    <nav>
      <h2><a href="index.html">Home</a></h2>
      <h3>Modules</h3>
      <ul>
        <li><a href="module-api_helper.html">api_helper</a></li>
        <li><a href="module-app.html">app</a></li>
        <li><a href="module-carpark_manager.html">carpark_manager</a></li>
        <li><a href="module-search_manager.html">search_manager</a></li>
        <li><a href="module-users_manager.html">users_manager</a></li>
      </ul>
      <h3>Classes</h3>
      <ul>
        <li><a href="DatabaseAPI.html">DatabaseAPI</a></li>
        <li><a href="URAAPI.html">URAAPI</a></li>
      </ul>
    </nav>

    <br class="clear" />

    <footer>
      Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.10</a> on Sat Mar 26 2022 16:05:03
      GMT+0800 (Singapore Standard Time)
    </footer>

    <script>
      prettyPrint();
    </script>
    <script src="scripts/linenumber.js"></script>
  </body>
</html>
